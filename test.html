<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BÂNG KHUÂNG - PHIÊU LƯU KÝ</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <style>
      :root {
        --primary-color: #d81b60;
        --secondary-color: #ff80ab;
        --background-light: #e0f7fa;
        --background-dark: #fce4ec;
        --text-color: #333;
        --card-bg: #fff;
        --border-radius-large: 10px;
        --border-radius-small: 6px;
        --box-shadow-main: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: "Segoe UI", sans-serif;
        background: linear-gradient(
          135deg,
          var(--background-light),
          var(--background-dark)
        );
        margin: 0;
        padding: 0;
        color: var(--text-color);
      }

      /* New CSS for about page */
      .about-container {
        max-width: 800px;
        margin: auto;
        background-color: var(--card-bg);
        padding: 40px;
        border-radius: var(--border-radius-large);
        box-shadow: var(--box-shadow-main);
        display: none; /* Hidden by default */
        line-height: 1.8;
      }
      .about-container.active {
        display: block;
      }
      .about-header {
        text-align: center;
        margin-bottom: 30px;
      }
      .about-header h1 {
        font-size: 2.5em;
        color: var(--primary-color);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .about-header p {
        color: var(--secondary-color);
        font-style: italic;
        font-size: 1.1em;
      }
      .content-section h2 {
        color: var(--primary-color);
        border-bottom: 2px solid var(--secondary-color);
        padding-bottom: 10px;
        margin-top: 30px;
        font-size: 1.5em;
      }
      .content-section p {
        margin-bottom: 20px;
        text-align: justify;
      }
      .highlight {
        font-weight: bold;
        color: var(--primary-color);
      }
      .support-info {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        background-color: var(--background-dark);
        border-radius: var(--border-radius-large);
        border: 1px solid #f8bbd0;
      }
      .support-info h3 {
        color: var(--primary-color);
        margin-bottom: 10px;
      }
      .support-info p {
        font-size: 1.1em;
        margin: 5px 0;
      }
      .about-back-button {
        display: none; /* This button is now part of the top nav */
      }

      /* Old CSS */
      .top-buttons-container {
        position: sticky;
        top: 20px;
        left: 20px;
        z-index: 1000;
        display: flex;
        gap: 10px;
        padding: 10px;
        background-color: transparent;
        box-shadow: none;
        align-items: center;
      }

      .home-button,
      .drive-button,
      .calendar-button,
      .contact-button,
      .profile-button,
      .notebook-button,
      .about-button {
        display: flex;
        align-items: center;
        background: linear-gradient(to right, var(--secondary-color), #f48fb1);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: var(--border-radius-small);
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s, box-shadow 0.2s;
        text-decoration: none;
      }
      .home-button:hover,
      .drive-button:hover,
      .calendar-button:hover,
      .contact-button:hover,
      .profile-button:hover,
      .notebook-button:hover,
      .about-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .main-content {
        display: flex;
        justify-content: center;
        gap: 20px;
        padding: 20px;
        flex-wrap: wrap;
        margin-top: 60px;
      }

      .container {
        max-width: 600px;
        flex-grow: 1;
        background-color: var(--card-bg);
        padding: 20px;
        border-radius: var(--border-radius-large);
        box-shadow: var(--box-shadow-main);
      }

      .blackboard-container,
      .note-container {
        width: 300px;
        padding: 15px;
        border-radius: var(--border-radius-large);
        box-shadow: var(--box-shadow-main);
        align-self: flex-start;
      }
      .blackboard-container {
        background-color: #2c3e50;
        border: 10px solid #a0522d;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5),
          0 5px 15px rgba(0, 0, 0, 0.3);
      }
      .note-container {
        background-color: #fffacd;
        transform: rotate(-2deg);
        position: relative;
      }

      .main-title,
      h2,
      h3 {
        text-align: center;
        color: var(--primary-color);
        cursor: pointer;
      }

      .main-title i,
      h2 i,
      h3 i {
        margin: 0 5px;
        color: var(--secondary-color);
      }

      textarea,
      input[type="text"] {
        width: 100%;
        padding: 10px;
        margin: 5px 0 10px;
        border: 1px solid #ccc;
        border-radius: var(--border-radius-small);
        font-size: 14px;
        box-sizing: border-box;
      }
      .flatpickr-input {
        width: calc(100% - 22px);
      }

      button,
      .button {
        padding: 8px 14px;
        margin: 6px 4px 6px 0;
        border: none;
        border-radius: var(--border-radius-small);
        background: linear-gradient(to right, var(--secondary-color), #f48fb1);
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      button:hover,
      .button:hover {
        background: linear-gradient(to right, var(--primary-color), #f06292);
        transform: translateY(-2px);
      }
      button i,
      .button i {
        margin-right: 5px;
      }

      .file-upload-container {
        display: block;
        width: 150px;
        margin: 10px auto 15px;
        border: 2px dashed var(--secondary-color);
        border-radius: var(--border-radius-large);
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      .file-upload-container:hover {
        background-color: var(--background-dark);
      }
      .file-upload-container i {
        font-size: 1.8em;
        color: var(--primary-color);
      }
      .file-upload-container p {
        margin: 5px 0 0;
        color: var(--primary-color);
        font-weight: bold;
        font-size: 0.9em;
      }
      input[type="file"] {
        display: none;
      }
      .image-preview img {
        max-width: 100%;
        height: auto;
        border-radius: var(--border-radius-small);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .status {
        background: var(--background-dark);
        border: 1px solid #f8bbd0;
        padding: 15px;
        border-radius: var(--border-radius-large);
        margin-bottom: 20px;
        transition: transform 0.2s ease;
      }
      .status:hover {
        transform: scale(1.01);
      }
      .status-title {
        font-weight: bold;
        font-size: 1.2em;
        color: var(--primary-color);
      }
      .status-time {
        font-size: 0.8em;
        color: #888;
        margin: 5px 0 10px;
      }
      .status-notes {
        margin-top: 10px;
        padding-left: 15px;
      }
      .note {
        font-size: 0.9em;
        background-color: #fff0f5;
        padding: 6px 10px;
        border-radius: 5px;
        margin: 5px 0;
      }

      .note-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 50px;
        height: 20px;
        background-color: #ffb74d;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
      }
      .note-container h3 {
        font-family: "Comic Sans MS", cursive, sans-serif;
        color: var(--primary-color);
        margin-top: 10px;
      }
      .note-list {
        list-style: none;
        padding: 0;
        margin-bottom: 10px;
      }
      .note-list li {
        background-color: #fffbe0;
        padding: 8px;
        border-radius: 5px;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-left: 5px solid var(--secondary-color);
      }
      .note-list li.completed {
        text-decoration: line-through;
        color: #888;
      }
      .note-list li button {
        background: none;
        color: var(--primary-color);
        font-size: 1.1em;
        border: none;
      }

      .blackboard-container h3 {
        color: #ecf0f1;
        font-family: "Comic Sans MS", cursive, sans-serif;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }
      .blackboard-container textarea {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffffa0;
        resize: none;
        height: 150px;
        font-family: "Chalkduster", "Marker Felt", "Comic Sans MS", cursive,
          sans-serif;
        font-size: 1.1em;
      }
      .blackboard-container button {
        background: linear-gradient(to right, #ffb74d, var(--secondary-color));
      }

      .clock-container {
        text-align: center;
        margin-bottom: 20px;
      }
      #realtime-clock {
        display: inline-block;
        background: linear-gradient(to right, #f48fb1, #ce93d8);
        padding: 10px 20px;
        border-radius: var(--border-radius-large);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        font-family: "Courier New", monospace;
        font-size: 1.5em;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        font-weight: bold;
      }

      #clover-reload-icon {
        position: fixed;
        font-size: 2em;
        cursor: grab;
        z-index: 1001;
        bottom: 20px;
        right: 20px;
        user-select: none;
        transition: transform 0.2s ease-in-out;
      }
      #clover-reload-icon:active {
        cursor: grabbing;
      }
      #whale-icon {
        position: fixed;
        font-size: 3em;
        color: #40c4ff;
        cursor: pointer;
        z-index: 1002;
        bottom: 50px;
        right: 50px;
        animation: whaleSwim 10s infinite alternate;
      }
      @keyframes whaleSwim {
        0% {
          transform: translate(0, 0) rotate(0deg);
        }
        25% {
          transform: translate(-100px, -50px) rotate(-10deg);
        }
        50% {
          transform: translate(-200px, 0) rotate(0deg);
        }
        75% {
          transform: translate(-100px, 50px) rotate(10deg);
        }
        100% {
          transform: translate(0, 0) rotate(0deg);
        }
      }
      .animate-whale {
        position: fixed;
        font-size: 3em;
        color: #40c4ff;
        animation: whaleFly 2s ease-out forwards;
        pointer-events: none;
        z-index: 9999;
      }
      @keyframes whaleFly {
        0% {
          transform: scale(0);
          opacity: 1;
        }
        100% {
          transform: scale(1.5) translate(var(--randX), var(--randY));
          opacity: 0;
        }
      }

      .footer {
        margin-top: 40px;
        padding: 20px;
        background: linear-gradient(90deg, #ffe0f0, #e0f7fa);
        font-size: 14px;
        color: #444;
        border-top: 1px solid #ddd;
        text-align: center;
        border-radius: var(--border-radius-large);
      }
      .footer a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: bold;
      }
      .footer a:hover {
        text-decoration: underline;
      }
      .footer .label {
        color: #888;
        font-weight: normal;
      }
      .footer i {
        margin-right: 5px;
        color: var(--primary-color);
      }

      .guide-header {
        cursor: pointer;
        padding: 12px 20px;
        border-radius: 25px;
        background: linear-gradient(135deg, #ff80ab, #f48fb1);
        color: white;
        text-align: center;
        font-weight: bold;
        font-size: 1.1em;
        transition: all 0.3s ease-in-out;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        text-transform: uppercase;
        letter-spacing: 1px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        text-decoration: none;
        margin-bottom: 20px;
      }
      .guide-header:hover {
        background: linear-gradient(135deg, var(--primary-color), #f06292);
        transform: scale(1.05) translateY(-2px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      }
      .guide-header i {
        font-size: 1.3em;
        color: white;
      }

      .install-app-popup {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.7);
        padding: 10px;
        border-radius: var(--border-radius-large);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        transition: transform 0.3s ease;
        max-width: 200px;
      }
      .install-app-popup:hover {
        transform: scale(1.05);
      }
      .install-app-popup a {
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
        color: var(--primary-color);
      }
      .install-app-popup .icon {
        font-size: 1.5em;
        color: var(--secondary-color);
      }
      .install-app-popup .text h3 {
        margin: 0;
        font-size: 0.9em;
        color: var(--primary-color);
      }
      .install-app-popup .text p {
        margin: 0;
        font-size: 0.7em;
        color: #666;
      }
      .profile-link-card {
        width: 100%;
        max-width: 600px;
        background-color: var(--card-bg);
        padding: 20px;
        border-radius: var(--border-radius-large);
        box-shadow: var(--box-shadow-main);
        text-align: center;
      }
      .profile-link-card a {
        display: block;
        padding: 15px;
        background-color: var(--primary-color);
        color: white;
        text-decoration: none;
        font-weight: bold;
        border-radius: var(--border-radius-small);
        transition: background-color 0.3s ease;
      }
      .profile-link-card a:hover {
        background-color: #c2185b;
      }
    </style>
  </head>
  <body>
    <div id="clover-reload-icon">🍀</div>
    <div id="whale-icon">
      🐋
      <audio
        id="bangkhieng-audio"
        src="duong_dan_den_bai_hat_bang_khuang.mp3"
        loop
      ></audio>
    </div>

    <!-- Navigation buttons container -->
    <div class="top-buttons-container">
      <a class="home-button" href="#" id="homeButton">
        <i class="fas fa-home"></i> Home
      </a>
      <a
        class="drive-button"
        href="https://drive.google.com/drive/folders/1cR4KwCDcmGDenk9qNfdYm23x5a2c-t3n?usp=sharing"
        target="_blank"
      >
        <i class="fas fa-folder"></i> Lưu trữ
      </a>
      <a class="calendar-button" href="calendar.html">
        <i class="fas fa-calendar-alt"></i> Lịch
      </a>
      <a class="contact-button" href="contact.html">
        <i class="fas fa-envelope"></i> Liên hệ
      </a>
      <a class="profile-button" href="trangcanhan.html">
        <i class="fas fa-user-circle"></i> Trang cá nhân
      </a>
      <a class="notebook-button" href="so_ghi_bai.html">
        <i class="fas fa-book"></i> Sổ ghi bài
      </a>
      <a class="about-button" href="#" id="aboutButton">
        <i class="fas fa-info-circle"></i> Về chúng tôi
      </a>
    </div>

    <!-- Main application content container -->
    <div id="mainAppContainer">
      <a class="guide-header" href="huong_dan_su_dung.html">
        <i class="fas fa-question-circle"></i> Hướng dẫn sử dụng
      </a>

      <!-- Main content container with all the app sections -->
      <div class="main-content">
        <!-- Center container with status updates -->
        <div class="container">
          <div class="clock-container">
            <div id="realtime-clock">00:00:00</div>
          </div>
          <h2 class="main-title"><i class="fas fa-pen-alt"></i>Gửi bài viết</h2>
          <div>
            <input type="text" id="title" placeholder="Tiêu đề bài viết..." />
            <textarea
              id="content"
              rows="4"
              placeholder="Nội dung bài viết..."
            ></textarea>
            <label>
              <input type="checkbox" id="completed" /> Đã hoàn thành
            </label>
            <div class="file-upload-container">
              <input type="file" id="imageUpload" accept="image/*" />
              <label for="imageUpload">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Tải ảnh lên</p>
              </label>
            </div>
            <div id="imagePreview"></div>
            <button onclick="addStatus()">
              <i class="fas fa-share"></i> Đăng
            </button>
          </div>
          <h2><i class="fas fa-history"></i>Hoạt động</h2>
          <div
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              margin-bottom: 20px;
            "
          >
            <label for="filterDate">Lọc theo ngày:</label>
            <input type="text" id="filterDate" placeholder="Chọn ngày..." />
          </div>
          <div id="statusList"></div>
        </div>

        <!-- Left blackboard container for important notes -->
        <div class="blackboard-container">
          <h3><i class="fas fa-star"></i>Lưu ý quan trọng</h3>
          <textarea
            id="importantNotes"
            placeholder="Nhập lưu ý của bạn tại đây..."
          ></textarea>
          <button onclick="saveImportantNotes()">
            <i class="fas fa-save"></i> Lưu
          </button>
          <button onclick="clearImportantNotes()">
            <i class="fas fa-times"></i> Xóa
          </button>
        </div>

        <!-- Right container for to-do list -->
        <div class="note-container">
          <h3><i class="fas fa-list-ul"></i>Ghi chú công việc</h3>
          <input
            type="text"
            id="noteInput"
            placeholder="Thêm công việc mới..."
          />
          <button onclick="addNoteItem()">
            <i class="fas fa-plus"></i> Thêm
          </button>
          <ul id="note-list" class="note-list"></ul>
          <button onclick="clearCompletedNotes()">
            <i class="fas fa-check"></i> Xóa đã hoàn thành
          </button>
        </div>
      </div>

      <!-- Footer section -->
      <div class="footer">
        <div>
          <i class="fas fa-user"></i
          ><span class="label">Designed and developed by:</span>Bùi Quốc Huy
        </div>
        <div>
          <i class="fab fa-facebook"></i><span class="label">Facebook:</span>
          <a href="https://www.facebook.com/bangkhuang187" target="_blank"
            >facebook.com/bangkhuang187</a
          >
        </div>
        <div>
          <i class="fas fa-phone"></i
          ><span class="label">Phone:</span> 0905640544
        </div>
        <div>
          <i class="fas fa-code-branch"></i
          ><span class="label">Version:</span> 0.1.4
        </div>
      </div>
    </div>

    <!-- About page container, hidden by default -->
    <div id="aboutContainer" class="about-container">
      <div class="about-header">
        <h1>Bâng Khuâng - Phiêu Lưu Ký</h1>
        <p>Lời tâm sự từ nhà phát triển</p>
      </div>

      <div class="content-section">
        <p>
          Chào các bạn, tôi là <span class="highlight">Bùi Quốc Huy</span>,
          người đã phát triển trang web này. Tôi muốn chia sẻ một chút về hành
          trình đầy cảm hứng và cả những thách thức đã dẫn đến sự ra đời của
          <span class="highlight">"Bâng Khuâng - Phiêu Lưu Ký"</span>.
        </p>
        <h2>Hành trình từ con số không</h2>
        <p>
          Tôi khởi đầu không phải là một lập trình viên chuyên nghiệp. Thực tế,
          vào ngày <span class="highlight">17/8/2023</span>, tôi đã bắt đầu
          những bước đi chập chững đầu tiên trong thế giới code thông qua các
          bài hướng dẫn trên kênh YouTube
          <span class="highlight">"Gà Lại Lập Trình"</span>. Hành trình này đã
          mở ra một chân trời mới, nhưng cũng đầy rẫy những bâng khuâng và khó
          khăn.
        </p>
        <p>
          Trong suốt quá trình học tập và làm việc, tôi luôn ấp ủ một ý tưởng:
          tạo ra một công cụ ghi chú và quản lý công việc mang đậm dấu ấn cá
          nhân, đủ linh hoạt để đáp ứng nhu cầu của riêng tôi. Tôi đã tìm kiếm
          nhiều phần mềm, nhưng vẫn chưa tìm thấy một giải pháp nào thực sự tối
          ưu và hiệu quả theo cách mà tôi mong muốn.
        </p>
        <h2>Sự ra đời của dự án</h2>
        <p>
          Chính vì vậy, vào ngày <span class="highlight">7/8/2024</span>, tôi đã
          quyết định "tự tay" phát triển một trang web để biến ý tưởng này thành
          hiện thực.
          <span class="highlight">"Bâng Khuâng - Phiêu Lưu Ký"</span> là sản
          phẩm đầu tay, được tôi xây dựng với tất cả sự kiên trì, đam mê và
          nhiệt huyết. Trong suốt quá trình này, tôi đã nhận được sự hỗ trợ vô
          cùng đắc lực từ các công cụ AI như Gemini và ChatGPT. Gemini, với khả
          năng cung cấp giải pháp và gợi ý code, đã đóng vai trò vô cùng quan
          trọng, giúp tôi vượt qua nhiều rào cản kỹ thuật và định hình nên sản
          phẩm như ngày hôm nay.
        </p>
        <h2>Mục tiêu và mong muốn</h2>
        <p>
          <span class="highlight">"Bâng Khuâng - Phiêu Lưu Ký"</span> không chỉ
          là một trang web. Nó là sự kết hợp giữa giao diện người dùng thân
          thiện, trải nghiệm mượt mà và các tính năng hữu ích được tạo ra từ một
          người làm web không chuyên. Tôi đã tập trung vào việc mang đến một
          không gian riêng tư, ổn định và đầy cảm hứng để mỗi người chúng ta có
          thể lưu giữ những suy nghĩ, những kế hoạch và những dấu ấn của cuộc
          đời mình.
        </p>
        <p>
          Tôi rất mong nhận được những feedback từ các bạn – cả những lời khen
          và cả những góp ý mang tính xây dựng. Mọi đóng góp đều là nguồn động
          lực to lớn giúp tôi tiếp tục "debug" và "update" dự án này trong tương
          lai.
        </p>
      </div>

      <div class="support-info">
        <h3>Ủng hộ và đóng góp</h3>
        <p>
          Nếu bạn cảm thấy dự án này hữu ích và muốn ủng hộ hành trình của tôi,
          bạn có thể đóng góp qua:
        </p>
        <p class="highlight">Ngân hàng Techcombank: 4020406868</p>
        <p class="highlight">Tên tài khoản: Bùi Quốc Huy</p>
      </div>
    </div>

    <!-- Scripts for all functionalities -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      // New script for toggling views
      document.addEventListener("DOMContentLoaded", () => {
        const homeButton = document.getElementById("homeButton");
        const aboutButton = document.getElementById("aboutButton");
        const mainAppContainer = document.getElementById("mainAppContainer");
        const aboutContainer = document.getElementById("aboutContainer");

        homeButton.addEventListener("click", (e) => {
          e.preventDefault();
          mainAppContainer.style.display = "block";
          aboutContainer.style.display = "none";
        });

        aboutButton.addEventListener("click", (e) => {
          e.preventDefault();
          mainAppContainer.style.display = "none";
          aboutContainer.style.display = "block";
        });
      });

      // Script cho các chức năng tương tác và lưu trữ dữ liệu
      // Xử lý icon cá voi và âm thanh
      const whaleIcon = document.getElementById("whale-icon");
      const audio = document.getElementById("bangkhieng-audio");
      let isPlaying = false;
      whaleIcon.addEventListener("click", () => {
        if (isPlaying) {
          audio.pause();
          whaleIcon.style.animationPlayState = "paused";
          isPlaying = false;
        } else {
          audio.play();
          whaleIcon.style.animationPlayState = "running";
          isPlaying = true;
        }
      });
      // Script cho đồng hồ thời gian thực
      function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        const seconds = String(now.getSeconds()).padStart(2, "0");
        document.getElementById(
          "realtime-clock"
        ).textContent = `${hours}:${minutes}:${seconds}`;
      }
      updateClock();
      setInterval(updateClock, 1000);
      // IndexedDB Helper Functions
      const DB_NAME = "LocketHuyDB";
      const DB_VERSION = 1;
      let db;
      function openDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(DB_NAME, DB_VERSION);
          request.onerror = (event) =>
            reject("IndexedDB error: " + event.target.errorCode);
          request.onsuccess = (event) => {
            db = event.target.result;
            resolve(db);
          };
          request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains("statuses")) {
              db.createObjectStore("statuses", {
                keyPath: "id",
                autoIncrement: true,
              });
            }
            if (!db.objectStoreNames.contains("notes")) {
              db.createObjectStore("notes", {
                keyPath: "id",
                autoIncrement: true,
              });
            }
            if (!db.objectStoreNames.contains("importantNotes")) {
              db.createObjectStore("importantNotes", { keyPath: "id" });
            }
          };
        });
      }
      async function saveToDB(storeName, data) {
        if (!db) await openDB();
        const transaction = db.transaction([storeName], "readwrite");
        const store = transaction.objectStore(storeName);
        store.put(data);
        return new Promise((resolve, reject) => {
          transaction.oncomplete = () => resolve();
          transaction.onerror = (event) => reject(event.target.error);
        });
      }
      async function getAllFromDB(storeName) {
        if (!db) await openDB();
        const transaction = db.transaction([storeName], "readonly");
        const store = transaction.objectStore(storeName);
        const request = store.getAll();
        return new Promise((resolve, reject) => {
          request.onsuccess = (event) => resolve(event.target.result);
          request.onerror = (event) => reject(event.target.error);
        });
      }
      async function getByIdFromDB(storeName, id) {
        if (!db) await openDB();
        const transaction = db.transaction([storeName], "readonly");
        const store = transaction.objectStore(storeName);
        const request = store.get(id);
        return new Promise((resolve, reject) => {
          request.onsuccess = (event) => resolve(event.target.result);
          request.onerror = (event) => reject(event.target.error);
        });
      }
      async function deleteFromDB(storeName, id) {
        if (!db) await openDB();
        const transaction = db.transaction([storeName], "readwrite");
        const store = transaction.objectStore(storeName);
        store.delete(id);
        return new Promise((resolve, reject) => {
          transaction.oncomplete = () => resolve();
          transaction.onerror = (event) => reject(event.target.error);
        });
      }
      const statusList = document.getElementById("statusList");
      flatpickr("#filterDate", { dateFormat: "Y-m-d" });
      function formatTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        if (seconds < 60) return `${seconds} giây trước`;
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes} phút trước`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours} giờ trước`;
        const days = Math.floor(hours / 24);
        return `${days} ngày trước`;
      }
      async function addStatus() {
        const title = document.getElementById("title").value.trim();
        const content = document.getElementById("content").value.trim();
        const completed = document.getElementById("completed").checked;
        const imageFile = document.getElementById("imageUpload").files[0];
        const timestamp = new Date();
        if (title === "" && content === "" && !imageFile) return;
        const status = {
          title,
          content,
          completed,
          timestamp,
          image: null,
          notes: [],
          history: [],
        };
        const reader = new FileReader();
        reader.onload = async function () {
          status.image = imageFile ? reader.result : null;
          await saveToDB("statuses", status);
          renderStatuses();
          document.getElementById("title").value = "";
          document.getElementById("content").value = "";
          document.getElementById("completed").checked = false;
          document.getElementById("imageUpload").value = "";
          document.getElementById("imagePreview").innerHTML = "";
          for (let i = 0; i < 6; i++) {
            createWhaleEffect();
          }
        };
        if (imageFile) {
          reader.readAsDataURL(imageFile);
        } else {
          await saveToDB("statuses", status);
          renderStatuses();
          for (let i = 0; i < 6; i++) {
            createWhaleEffect();
          }
        }
      }
      async function renderStatuses() {
        statusList.innerHTML = "";
        const statuses = await getAllFromDB("statuses");
        statuses.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        const filterDate = document.getElementById("filterDate").value;
        statuses.forEach((status) => {
          if (
            filterDate &&
            new Date(status.timestamp).toISOString().slice(0, 10) !== filterDate
          ) {
            return;
          }
          const div = document.createElement("div");
          div.className = "status";
          div.innerHTML = `
            <div class="status-title">${status.title}</div>
            <div class="status-time">${formatTimeAgo(
              new Date(status.timestamp)
            )} - ${new Date(status.timestamp).toLocaleString("vi-VN", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          })}</div>
            ${
              status.image
                ? `<img src="${status.image}" alt="Hình ảnh bài viết" style="max-width: 100%; margin-top: 10px; border-radius: 5px;" />`
                : ""
            }
            <p>${status.content.replace(/\n/g, "<br/>")}</p>
            <button onclick="toggleCompleted(${
              status.id
            })"><i class="fas fa-check-circle"></i> ${
            status.completed ? "Chưa xong" : "Hoàn thành"
          }</button>
            <button onclick="editStatus(${
              status.id
            })"><i class="fas fa-edit"></i> Sửa</button>
            <button onclick="deleteStatus(${
              status.id
            })"><i class="fas fa-trash-alt"></i> Xóa</button>
            <button onclick="viewHistory(${
              status.id
            })"><i class="fas fa-history"></i> Nhật ký chỉnh sửa</button>
            <div><input type="text" id="noteInput-${
              status.id
            }" placeholder="Thêm ghi chú..." /><button onclick="addNote(${
            status.id
          })"><i class="fas fa-paper-plane"></i> Gửi</button></div>
            <div class="status-notes">${status.notes
              .map((note) => `<div class="note">${note}</div>`)
              .join("")}</div>
            <div id="history-${
              status.id
            }" style="display:none; font-size: 0.85em; margin-top: 8px;"></div>
          `;
          statusList.appendChild(div);
        });
      }
      async function toggleCompleted(id) {
        const status = await getByIdFromDB("statuses", id);
        if (status) {
          status.completed = !status.completed;
          await saveToDB("statuses", status);
          renderStatuses();
        }
      }
      async function deleteStatus(id) {
        if (confirm("Bạn chắc chắn muốn xóa bài viết này?")) {
          await deleteFromDB("statuses", id);
          renderStatuses();
        }
      }
      function editStatus(id) {
        window.location.href = `edit_status.html?id=${id}`;
      }
      async function viewHistory(id) {
        const status = await getByIdFromDB("statuses", id);
        const container = document.getElementById(`history-${id}`);
        if (!status || !status.history || status.history.length === 0) {
          container.innerHTML = "<i>Không có chỉnh sửa nào.</i>";
        } else {
          container.innerHTML = status.history
            .map(
              (h) => `
                <div style="margin-bottom:6px;">
                    <strong>${new Date(
                      h.editedAt
                    ).toLocaleString()}</strong><br/>
                    <div>Tiêu đề cũ: ${h.oldTitle}</div>
                    <div>Tiêu đề mới: ${h.newTitle}</div>
                    <div>Nội dung cũ: ${h.oldContent.replace(
                      /\n/g,
                      "<br/>"
                    )}</div>
                    <div>Nội dung mới: ${h.newContent.replace(
                      /\n/g,
                      "<br/>"
                    )}</div>
                </div>
            `
            )
            .join("");
        }
        container.style.display =
          container.style.display === "none" ? "block" : "none";
      }
      // Script cho ghi chú công việc
      const noteInput = document.getElementById("noteInput");
      const noteList = document.getElementById("note-list");
      noteInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          addNoteItem();
        }
      });
      async function addNoteItem() {
        const noteText = noteInput.value.trim();
        if (noteText) {
          const note = { text: noteText, completed: false };
          await saveToDB("notes", note);
          noteInput.value = "";
          renderNoteItems();
        }
      }
      async function renderNoteItems() {
        noteList.innerHTML = "";
        const notes = await getAllFromDB("notes");
        notes.forEach((note) => {
          const li = document.createElement("li");
          li.className = note.completed ? "completed" : "";
          li.innerHTML = `
            <span onclick="toggleNoteCompleted(${note.id})">${note.text}</span>
            <button onclick="deleteNoteItem(${note.id})"><i class="fas fa-trash-alt"></i></button>
          `;
          noteList.appendChild(li);
        });
      }
      async function toggleNoteCompleted(id) {
        const note = await getByIdFromDB("notes", id);
        if (note) {
          note.completed = !note.completed;
          await saveToDB("notes", note);
          renderNoteItems();
        }
      }
      async function deleteNoteItem(id) {
        await deleteFromDB("notes", id);
        renderNoteItems();
      }
      async function clearCompletedNotes() {
        const notes = await getAllFromDB("notes");
        const completedNotes = notes.filter((note) => note.completed);
        for (const note of completedNotes) {
          await deleteFromDB("notes", note.id);
        }
        renderNoteItems();
      }
      // Script cho lưu ý quan trọng
      async function saveImportantNotes() {
        const importantNotes = document.getElementById("importantNotes").value;
        const noteData = { id: 1, notes: importantNotes };
        await saveToDB("importantNotes", noteData);
        alert("Đã lưu lưu ý quan trọng!");
      }
      async function loadImportantNotes() {
        const noteData = await getByIdFromDB("importantNotes", 1);
        if (noteData && noteData.notes) {
          document.getElementById("importantNotes").value = noteData.notes;
        }
      }
      async function clearImportantNotes() {
        document.getElementById("importantNotes").value = "";
        await deleteFromDB("importantNotes", 1);
      }
      document
        .getElementById("imageUpload")
        .addEventListener("change", function () {
          const preview = document.getElementById("imagePreview");
          preview.innerHTML = "";
          const file = this.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const img = document.createElement("img");
              img.src = e.target.result;
              preview.appendChild(img);
            };
            reader.readAsDataURL(file);
          }
        });
      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }
      function createWhaleEffect() {
        const whale = document.createElement("span");
        whale.className = "animate-whale";
        whale.innerHTML = "🐋";
        const randX =
          Math.random() * (window.innerWidth - 100) - window.innerWidth / 2;
        const randY =
          Math.random() * (window.innerHeight - 100) - window.innerHeight / 2;
        whale.style.setProperty("--randX", randX);
        whale.style.setProperty("--randY", randY);
        document.body.appendChild(whale);
        setTimeout(() => {
          whale.remove();
        }, 2000);
      }

      window.addEventListener("DOMContentLoaded", async () => {
        await openDB();
        document.getElementById("filterDate").value = "";
        renderStatuses();
        renderNoteItems();
        loadImportantNotes();
      });

      // Script cho cỏ ba lá
      const cloverIcon = document.getElementById("clover-reload-icon");
      let isDragging = false;
      let offsetX, offsetY;
      cloverIcon.addEventListener("mousedown", (e) => {
        isDragging = true;
        cloverIcon.style.cursor = "grabbing";
        offsetX = e.clientX - cloverIcon.getBoundingClientRect().left;
        offsetY = e.clientY - cloverIcon.getBoundingClientRect().top;
      });
      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        cloverIcon.style.left = e.clientX - offsetX + "px";
        cloverIcon.style.top = e.clientY - offsetY + "px";
      });
      document.addEventListener("mouseup", () => {
        if (!isDragging) return;
        isDragging = false;
        cloverIcon.style.cursor = "grab";
      });
      cloverIcon.addEventListener("click", (e) => {
        if (
          e.clientX - offsetX === cloverIcon.getBoundingClientRect().left &&
          e.clientY - offsetY === cloverIcon.getBoundingClientRect().top
        ) {
          window.location.reload();
        }
      });
    </script>
  </body>
</html>
